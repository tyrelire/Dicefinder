{% extends 'base.html.twig' %}

{% block title %}Modifier Profil{% endblock %}

{% block body %}

<div class="container mx-auto px-4 py-8 mt-20">

    {% for message in app.flashes('success') %}
        <div class="alert-message bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6" role="alert">
            {{ message }}
        </div>
    {% endfor %}

    {% for message in app.flashes('error') %}
        <div class="alert-message bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert">
            {{ message }}
        </div>
    {% endfor %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="bg-white p-6 rounded-lg shadow-lg w-full">
            <h2 class="text-2xl font-bold text-center mb-6">Modifier Profil</h2>

            {{ form_start(form) }}
            <div class="mb-4">
                {{ form_label(form.username, 'Nom d\'utilisateur', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                {{ form_widget(form.username, {
                    'attr': {
                        'class': 'bg-gray-200 text-gray-500 text-sm rounded-lg w-full p-2.5',
                        'readonly': true
                    }
                }) }}
                {{ form_errors(form.username) }}
            </div>

            <div class="mb-4">
                {{ form_label(form.firstName, 'Prénom', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                {{ form_widget(form.firstName, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full p-2.5'}}) }}
                {{ form_errors(form.firstName) }}
            </div>

            <div class="mb-4">
                {{ form_label(form.lastName, 'Nom', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                {{ form_widget(form.lastName, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full p-2.5'}}) }}
                {{ form_errors(form.lastName) }}
            </div>

            <div class="mb-4">
                {{ form_label(form.email, 'Adresse email', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                <div class="relative mt-1 rounded-md shadow-sm">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path d="M3 4a2 2 0 00-2 2v1.161l8.441 4.221a1.25 1.25 0 001.118 0L19 7.162V6a2 2 0 00-2-2H3z" />
                            <path d="M19 8.839l-7.77 3.885a2.75 2.75 0 01-2.46 0L1 8.839V14a2 2 0 002 2h14a2 2 0 002-2V8.839z" />
                        </svg>
                    </div>
                    {{ form_widget(form.email, {
                        'attr': {
                            'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 p-2.5',
                            'placeholder': 'you@example.com'
                        }
                    }) }}
                </div>
                {{ form_errors(form.email) }}
            </div>

            <div class="mb-4">
                {{ form_label(form.phoneNumber, 'Numéro de téléphone', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                <div class="relative mt-1 rounded-md shadow-sm">
                    <div class="absolute inset-y-0 left-0 flex items-center">
                        <select id="country" name="country" autocomplete="country" class="h-full rounded-md border-transparent bg-transparent py-0 pl-3 pr-7 text-gray-500 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="EU">EU</option>
                        </select>
                    </div>
                    {{ form_widget(form.phoneNumber, {
                        'attr': {
                            'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full pl-20 p-2.5', 
                            'placeholder': '+33 1 23 4 5 67'
                        }
                    }) }}
                </div>
                {{ form_errors(form.phoneNumber) }}
            </div>

            <div class="mb-4">
                {{ form_label(form.birthDate, 'Date de naissance', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                {{ form_widget(form.birthDate, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full p-2.5'}}) }}
                {{ form_errors(form.birthDate) }}
            </div>

            <div class="mb-4">
                {{ form_row(form.gender, {
                    'label': 'Genre',
                    'attr': {'class': 'flex items-center space-x-4'}
                }) }}
            </div>

            <div class="mb-4">
                {{ form_label(form.bio, 'Biographie', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                {{ form_widget(form.bio, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full p-2.5'}}) }}
                {{ form_errors(form.bio) }}
            </div>

            <div class="flex justify-end">
                <button type="submit" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700">
                    Mettre à jour
                </button>
            </div>
            {{ form_end(form) }}
        </div>
        
        <div class="flex flex-col space-y-8">
            <div class="bg-white p-6 rounded-lg shadow-lg w-full h-full">
                <h2 class="text-2xl font-bold text-center mb-6">Changer le mot de passe</h2>
                {{ form_start(passwordForm) }}
                <div class="mb-4">
                    {{ form_label(passwordForm.current_password, 'Mot de passe actuel', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                    {{ form_widget(passwordForm.current_password, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 w-full p-2.5'}}) }}
                    {{ form_errors(passwordForm.current_password) }}
                </div>

                <div class="mb-4">
                    {{ form_label(passwordForm.new_password, 'Nouveau mot de passe', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                    {{ form_widget(passwordForm.new_password, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 w-full p-2.5'}}) }}
                    {{ form_errors(passwordForm.new_password) }}
                </div>

                <div class="mb-4">
                    {{ form_label(passwordForm.confirm_password, 'Confirmer le nouveau mot de passe', {'label_attr': {'class': 'block text-gray-700 mb-1'}}) }}
                    {{ form_widget(passwordForm.confirm_password, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 w-full p-2.5'}}) }}
                    {{ form_errors(passwordForm.confirm_password) }}
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700">
                        Mettre à jour le mot de passe
                    </button>
                </div>
                {{ form_end(passwordForm) }}
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-lg w-full h-full">
                <h2 class="text-2xl font-bold text-center mb-6">Modifier l'avatar</h2>
                {{ form_start(avatarForm, {'attr': {'enctype': 'multipart/form-data'}}) }}
                
                <div class="flex items-center justify-center mb-6">
                    <div class="flex flex-col items-center mr-6">
                        {% if app.user.avatar %}
                            <img class="w-40 h-40 rounded-full ring-4 ring-indigo-300 object-cover"
                                src="{{ asset('uploads/avatars/' ~ app.user.avatar) }}" alt="Photo de profil">
                            <button type="submit" name="delete_avatar" value="1" class="text-red-600 text-xs mt-2 underline hover:text-red-800">
                                Supprimer la photo
                            </button>
                        {% else %}
                            <img class="w-40 h-40 rounded-full ring-4 ring-indigo-300 object-cover"
                                src="{{ asset('images/default-avatar.png') }}" alt="Photo de profil par défaut">
                        {% endif %}
                    </div>
                    <div class="ml-6">
                        {{ form_widget(avatarForm.avatar, {'attr': {'class': 'hidden'}}) }}
                        {{ form_errors(avatarForm.avatar) }}
                        <label for="{{ avatarForm.avatar.vars.id }}" class="cursor-pointer bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 inline-flex items-center">
                            <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
                            </svg>
                            Choisir une photo
                        </label>
                        <p class="text-xs text-gray-500 mt-2">JPG, GIF or PNG. 1MB max.</p>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700">
                        Mettre à jour l'avatar
                    </button>
                </div>
                {{ form_end(avatarForm) }}
            </div>
        </div>
    </div>
</div>

<script>
    setTimeout(function() {
        document.querySelectorAll('.alert-message').forEach(function(element) {
            element.style.transition = 'opacity 0.5s';
            element.style.opacity = 0;
            setTimeout(function() {
                element.remove();
            }, 500);
        });
    }, 5000);
</script>

{% endblock %}
